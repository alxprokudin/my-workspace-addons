# üíæ –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä –±–µ–∑ Google Drive

## ‚ùì –í–æ–ø—Ä–æ—Å

–ú–æ–∂–Ω–æ –ª–∏ –≤ Google Workspace Add-on —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä), –º–∏–Ω—É—è Google Drive?

## ‚úÖ –û—Ç–≤–µ—Ç: –î–ê, –≤–æ–∑–º–æ–∂–Ω–æ!

## üîç –ê–Ω–∞–ª–∏–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π

### –í–∞—Ä–∏–∞–Ω—Ç 1: HTML5 Download API —Å Blob URL (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. **–°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å (Apps Script):**
   - –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –ª–∏—Å—Ç –≤ Excel —Ñ–æ—Ä–º–∞—Ç (blob)
   - –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç blob –≤ base64 —Å—Ç—Ä–æ–∫—É
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç base64 + –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–∏–º—è —Ñ–∞–π–ª–∞, MIME type)

2. **–ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å (HTML Service):**
   - –ü–æ–ª—É—á–∞–µ—Ç base64 –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `google.script.run`
   - –î–µ–∫–æ–¥–∏—Ä—É–µ—Ç base64 –æ–±—Ä–∞—Ç–Ω–æ –≤ –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
   - –°–æ–∑–¥–∞–µ—Ç Blob –æ–±—ä–µ–∫—Ç
   - –°–æ–∑–¥–∞–µ—Ç Blob URL —á–µ—Ä–µ–∑ `URL.createObjectURL()`
   - –°–æ–∑–¥–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å—Å—ã–ª–∫—É `<a>` —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º `download`
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–ª–∏–∫–∞–µ—Ç –ø–æ —Å—Å—ã–ª–∫–µ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
   - –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç Blob URL

**–ö–æ–¥ (–ø—Ä–∏–º–µ—Ä):**

```javascript
// –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å (appsScript.js)
function getExcelBlobAsBase64() {
  // ... —ç–∫—Å–ø–æ—Ä—Ç —Ñ–∞–π–ª–∞ ...
  const blob = /* Excel blob */;
  const base64 = Utilities.base64Encode(blob.getBytes());
  return {
    data: base64,
    name: `${nameActiveSheet}.xlsx`,
    mimeType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
  };
}

// –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å (dialog.html)
function downloadFile() {
  google.script.run
    .withSuccessHandler((fileData) => {
      // –î–µ–∫–æ–¥–∏—Ä—É–µ–º base64
      const byteCharacters = atob(fileData.data);
      const byteNumbers = new Array(byteCharacters.length);
      for (let i = 0; i < byteCharacters.length; i++) {
        byteNumbers[i] = byteCharacters.charCodeAt(i);
      }
      const byteArray = new Uint8Array(byteNumbers);
      
      // –°–æ–∑–¥–∞–µ–º Blob
      const blob = new Blob([byteArray], { type: fileData.mimeType });
      
      // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = fileData.name;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    })
    .getExcelBlobAsBase64();
}
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

1. ‚úÖ **–ù–µ —Ç—Ä–µ–±—É–µ—Ç Google Drive scope** - –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `spreadsheets.currentonly`
2. ‚úÖ **–ü—Ä—è–º–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ** - —Ñ–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. ‚úÖ **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π HTML5 –ø–æ–¥—Ö–æ–¥** - —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–æ –≤—Å–µ—Ö —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö
4. ‚úÖ **–ù–µ –Ω—É–∂–Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å –ø–∞–ø–∫—É** - –ø—Ä–æ—â–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:

1. ‚ö†Ô∏è **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞:** –û–≥—Ä–∞–Ω–∏—á–µ–Ω —Ä–∞–∑–º–µ—Ä–æ–º –¥–∞–Ω–Ω—ã—Ö –≤ `google.script.run` (–æ–±—ã—á–Ω–æ –¥–æ 50MB)
2. ‚ö†Ô∏è **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** Base64 —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –Ω–∞ ~33%, –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
3. ‚ö†Ô∏è **–ü–∞–º—è—Ç—å:** –§–∞–π–ª –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ –ø–∞–º—è—Ç—å –±—Ä–∞—É–∑–µ—Ä–∞

## üìã –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ scopes (–±–µ–∑ Drive)

```json
"oauthScopes": [
  "https://www.googleapis.com/auth/spreadsheets.currentonly",  // –î–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–µ
  "https://www.googleapis.com/auth/script.external_request",   // –ï—Å–ª–∏ –Ω—É–∂–Ω—ã HTTP –∑–∞–ø—Ä–æ—Å—ã
  "https://www.googleapis.com/auth/script.container.ui"        // –î–ª—è UI
]
```

**–ú–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å `drive.file` scope –ø–æ–ª–Ω–æ—Å—Ç—å—é!**

## üéØ UX –≤–∞—Ä–∏–∞–Ω—Ç—ã

### –í–∞—Ä–∏–∞–Ω—Ç A: –¢–æ–ª—å–∫–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä
- –ü—Ä–æ—Å—Ç–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –û–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–°–∫–∞—á–∞—Ç—å Excel"
- –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–∞–ø–∫—É "–ó–∞–≥—Ä—É–∑–∫–∏" –±—Ä–∞—É–∑–µ—Ä–∞

### –í–∞—Ä–∏–∞–Ω—Ç B: –í—ã–±–æ—Ä (—Å–∫–∞—á–∞—Ç—å –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Drive)
- –î–≤–µ –æ–ø—Ü–∏–∏: "–°–∫–∞—á–∞—Ç—å –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä" –∏–ª–∏ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Google Drive"
- –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ Drive - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º Google Picker
- –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ - –∏—Å–ø–æ–ª—å–∑—É–µ–º Blob URL

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞:**
   - –î–ª—è —Ñ–∞–π–ª–æ–≤ –¥–æ ~10-20MB - –æ—Ç–ª–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –î–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ (>50MB) - –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–∞

2. **–ë—Ä–∞—É–∑–µ—Ä–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
   - –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
   - –ú–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è —è–≤–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∫–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ)

3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - Base64 –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `google.script.run`
   - –≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ Apps Script

## ‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

**–î–ê, —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ –∏ –¥–∞–∂–µ –ø—Ä–æ—â–µ, —á–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Drive!**

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç Drive scope
- ‚úÖ –ü—Ä–æ—â–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–µ –Ω—É–∂–Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å –ø–∞–ø–∫—É)
- ‚úÖ –ü—Ä—è–º–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä
- ‚úÖ –ú–µ–Ω—å—à–µ scopes = –ø—Ä–æ—â–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç —Å –ø—Ä—è–º—ã–º —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ–º –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä - —ç—Ç–æ —É–ø—Ä–æ—Å—Ç–∏—Ç UX –∏ —É–±–µ—Ä–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –≤ `drive.file` scope!

